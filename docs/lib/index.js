!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],t):t(e.ReactEditableContent={},e.React,e.PropTypes)}(this,function(e,t,n){"use strict";var s="default"in t?t.default:t;function g(e,t,n){var r=document.getSelection(),a=0<r.rangeCount&&r.getRangeAt(0),o=document.createRange();o.setStart(e,0),o.setEnd(t,n),r.removeAllRanges(),r.addRange(o);var i=r.toString().length;return r.removeAllRanges(),a&&r.addRange(a),i}function d(e,t){for(var n=function(e,t){if((e.innerText||e.textContent).length>=t){var n=e.childNodes;if(n.length<1)return{node:e,offset:t};for(var r=t,a=void 0,o=0;o<n.length&&!(((a=n[o]).innerText||a.textContent).length>=r);o++)r-=(a.innerText||a.textContent).length;return{node:a,offset:r}}return{node:null,offset:t}},r=n(e,t);r.node&&3!==r.node.nodeType&&0<r.node.childNodes.length;)r=n(r.node,r.offset);return r}function p(e,t){try{document.getSelection().removeAllRanges();var n=document.createRange();n.setStart(e,t),n.setEnd(e,t),document.getSelection().addRange(n)}catch(e){}}n=n&&n.hasOwnProperty("default")?n.default:n;var u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},f=function(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},h=function(e){function i(){var e,t,n;u(this,i);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return(t=n=c(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(a)))).setRef=function(e){n._elementRef=e},n.onPaste=function(e){e.preventDefault();var t=e.clipboardData;if(t.types.includes("text/plain")){var n=t.getData("text/plain");document.execCommand("insertText",!1,n)}},c(n,t)}return a(i,e),r(i,[{key:"getSnapshotBeforeUpdate",value:function(){var e=document.getSelection();return this._elementRef&&e.rangeCount&&this._elementRef.contains(e.anchorNode)?{caretPosition:g(this._elementRef,e.anchorNode,e.anchorOffset),caretPositionEnd:this._elementRef.contains(e.focusNode)&&g(this._elementRef,e.focusNode,e.focusOffset)}:{}}},{key:"componentDidUpdate",value:function(e,t,n){var r=n.caretPosition,a=n.caretPositionEnd;if(!this._elementRef||"number"!=typeof r)return p(this._elementRef,0);var o=d(this._elementRef,r),i=o.node,s=o.offset;if(!i)return p(this._elementRef,0);if(!a)return p(i,s);var u=d(this._elementRef,a),f=u.node,l=u.offset;if(!f)return p(i,s);document.getSelection().removeAllRanges();var c=document.createRange();c.setStart(i,s),c.setEnd(f,l),document.getSelection().addRange(c)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.element,r=e.uniqueKey,a=e.disabled,o=f(e,["children","element","uniqueKey","disabled"]),i=n||"div";return s.createElement(i,l({ref:this.setRef,contentEditable:!a,suppressContentEditableWarning:!0,key:r||Math.random(),onPaste:this.onPaste,style:{whiteSpace:"pre-wrap"}},o),t)}}]),i}(t.Component);h.propTypes={children:n.node,element:n.string,uniqueKey:n.string,disabled:n.bool};var o=function(e){function i(){var e,t,n;u(this,i);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return(t=n=c(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(a)))).update=function(e){(0,n.props.onChange)(e.target.innerText)},c(n,t)}return a(i,e),r(i,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.render,r=e.className,a=f(e,["text","render","className"]),o=t.length;return s.createElement(h,l({className:r,onInput:this.update,uniqueKey:o},a),n(t))}}]),i}(t.PureComponent);o.propTypes={text:n.string.isRequired,render:n.func.isRequired,className:n.string,onChange:n.func};var v=function(e){function o(){var e,t,f;u(this,o);for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=f=c(this,(e=o.__proto__||Object.getPrototypeOf(o)).call.apply(e,[this].concat(r)))).update=function(){var e=f.props,u=e.data,t=e.onChange,n=Array.from(f._ref.querySelectorAll("[data-node]"));if(0===n.length||1===n.length&&!n[0].innerText)return t([{text:f._ref.innerText}]);var r=n.reduce(function(e,t,n){var r=t.innerText,a=t.parentElement,o=t.dataset.nodeIndex;0<n&&1===a.nodeType&&a!==f._ref&&"block"===getComputedStyle(a).display&&!t.previousSibling&&(r="\n"+r);var i=l({},u[o]||{},{text:r});if(e.has(o)){var s=e.get(o).text;s.endsWith("\n")&&i.text.startsWith("\n")?s+=i.text.substring(1):s+=i.text,e.set(o,l({},i,{text:s}))}else e.set(o,i);return e},new Map);t(Array.from(r).sort(function(e,t){return i(e,1)[0]-i(t,1)[0]}).map(function(e){var t=i(e,2)[1];return delete t.nodeIndex,t}).filter(function(e){return"\n"!==e.text&&""!==e.text}))},f.renderDataList=function(e){var n=f.props.renderDataItem;return e.length?e.map(function(e,t){return s.createElement("span",{key:t,"data-node":!0,"data-node-index":t},n(e,t))}):s.createElement("span",{key:0,"data-node":!0,"data-node-index":0},s.createElement("br",null))},c(f,t)}return a(o,e),r(o,[{key:"componentDidMount",value:function(){var e=this.props.helperRef;this.helperRef=new y(this),e(this.helperRef)}},{key:"getDataNode",value:function(e){for(var t=e;t&&(!t.dataset||!t.dataset.nodeIndex);)t=t.parentElement;return t}},{key:"render",value:function(){var t=this,e=this.props,n=e.data,r=e.className,a=(e.renderDataItem,e.helperRef,f(e,["data","className","renderDataItem","helperRef"])),o=n.map(function(e){return e.text}).join("");return s.createElement(h,l({className:r,onInput:this.update,uniqueKey:o,ref:function(e){return t._ref=e&&e._elementRef}},a),this.renderDataList(n))}}]),o}(t.PureComponent);v.propTypes={data:n.object.isRequired,onChange:n.func.isRequired,renderDataItem:n.func.isRequired,helperRef:n.func};var y=function(){function i(e){u(this,i),this.componentInstance=e}return r(i,[{key:"cleanNodes",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:i.defaultMerge;return e.filter(function(e){return!!e&&!!e.text}).reduce(function(e,t){var n=e.length&&e[e.length-1];return r(n,t)?n.text+=t.text:e.push(t),e},[])}},{key:"getRef",value:function(){return this.componentInstance._ref}},{key:"getSelection",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.componentInstance,n=t._ref,r=t.props.data,a=document.getSelection();if(a.rangeCount){var o=document.getSelection().getRangeAt(0);if(n.contains(o.startContainer)&&n.contains(o.endContainer)){for(var i=a.toString(),s=o.startContainer;s&&(!s.dataset||!s.dataset.nodeIndex);)s=s.parentElement;if(s){var u=o.cloneRange(),f=g(s,o.startContainer,o.startOffset),l=o.endOffset+f-o.startOffset;if(a.addRange(u),o.startContainer===o.endContainer||o.startContainer.contains(o.endContainer)){var c=parseInt(s.dataset.nodeIndex,10),d=e&&o.collapsed;return[{index:c,text:d?s.innerText:i,startOffset:d?null:f,endOffset:d?null:l,dataItem:r[c]}]}var p=o.cloneContents(),h=Array.from(p.querySelectorAll("[data-node]"));return h.map(function(e,t){return{index:parseInt(e.dataset.nodeIndex,10),text:e.innerText,startOffset:0===t?f:null,endOffset:t===h.length-1?l:null,dataItem:r[parseInt(e.dataset.nodeIndex,10)]}}).filter(function(e){return e.text&&(null===e.endOffset||0<e.endOffset)})}}}}},{key:"applyToSelection",value:function(e,t){var n=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).expandWhenCollapsed,r=void 0===n||n,a=this.componentInstance.props.data,o=this.getSelection(r);if(o&&o.length)return this.cleanNodes(i.updateNodes(a,o,e),t)}}],[{key:"updateNodes",value:function(e,a,o){return e.reduce(function(e,t,n){var r=a.find(function(e){return e.index===n});return r?(r.startOffset&&e.push(l({},t,{text:t.text.substring(0,r.startOffset)})),e.push(l({},o(t,r,n,a),{text:t.text.substring(r.startOffset||0,r.endOffset||t.text.length)})),r.endOffset&&e.push(l({},t,{text:t.text.substring(r.endOffset)}))):e.push(t),e},[])}},{key:"defaultMerge",value:function(t,n){return Object.keys(t).length===Object.keys(n).length&&Object.keys(t).every(function(e){return"text"===e||t[e]===n[e]})}}]),i}();e.EditableContent=h,e.EditableText=o,e.EditableData=v,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
